$(->

  $('.question').on('mouseenter', (event)->
    form = $(@).closest('li').find('.answer-form.hidden')
#    form = $('.rightpart.col-md-6').find('.answer-form.hidden')
    form.removeClass('hidden')
  )

  $('.question').on('mouseleave', ->
    li = $(@).closest('li')
    form = li.find('.answer-form')
#    form = $('.rightpart.col-md-6').find('.answer-form.hidden')
    form.addClass('hidden')
    questionid = form.data('questionid')
    answerid = form.data('answerid')
    answertextold = form.data('answertextold')
    answertextnew = form.find('.text-area').val()
    console.log("questionid = #{questionid}")
    console.log("answerid = #{answerid}")
    console.log("answertextold = #{answertextold}")
    console.log("answertextnew = #{answertextnew}")
    if answerid == 0
      if answertextnew != ''
        $.ajax('/answers',{
          type: 'POST',
          data: { 'answer': {'text': answertextnew, 'question_id': questionid } },
          success: ->
            console.log('Ответ сохранён')
#            li.find('a').removeClass('text-warning').addClass('text-success')
          ,
          error: ->
            console.log('Ответ НЕ был сохранён')
#            alert('Ответ не был сохранён')
#          ,
#          beforeSend: ->
#
#          ,
#          complete: ->
#
        })
    else
      if answertextold != answertextnew
        if answertextnew == ''
          $.ajax("/answers/#{answerid}",{
            type: 'DELETE',
            success: ->
              console.log('Ответ был удален')
#              li.find('a').removeClass('text-success').addClass('text-warning')
            ,
            error: ->
              console.log('Ответ НЕ был удален')
#              alert('Ответ не был сохранён')
          })
        else
          $.ajax("/answers/#{answerid}",{
            type: 'PUT',
            data: { 'answer': {'text': answertextnew, 'question_id': questionid } },
            success: ->
              console.log('Ответ изменён')
            ,
            error: ->
              console.log('Ответ НЕ был изменён')
#              alert('Ответ не был сохранён')
          })
  )
)
